<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAMA-DMBOK Interactive Wheel</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <h1>DAMA Knowledge Areas</h1>
        <p>Select a node to view its Structure.</p>
    </header>

    <div class="layout-wheel">
        <div class="wheel-wrapper" id="wheel">
            <svg class="lines" id="lines"></svg>
            <div class="center-node" onclick="renderPanel(0)" id="node-0">Data<br>Governance</div>
        </div>

        <div class="info-panel" id="panel">
            <div class="panel-header">
                <h2 id="p-title">Select Area</h2>
                <span class="tag" id="p-tag">...</span>
            </div>

            <div class="section-title">Essential Components</div>
            <ul id="p-comp"></ul>

            <div class="section-title">Key Deliverables</div>
            <ul id="p-deliv"></ul>

            <div class="pitfall-box">
                <strong>⚠️ Exam Pitfall:</strong>
                <div id="p-pitfall" style="margin-top:5px;">...</div>
            </div>

            <a href="#" id="p-link" class="btn-more">Open Deep Dive ↗</a>
        </div>
    </div>

    <script src="dama_content.js"></script>

    <script>
        const wheel = document.getElementById('wheel');
        const linesSvg = document.getElementById('lines');
        let currentActiveId = 0;

        function initWheel() {
            const rect = wheel.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const radius = rect.width * 0.35; 

            linesSvg.innerHTML = ''; 
            document.querySelectorAll('.node').forEach(n => n.remove());

            const outerNodes = damaData.filter(d => d.id !== 0);
            const angleStep = (2 * Math.PI) / outerNodes.length;

            outerNodes.forEach((item, index) => {
                const angle = index * angleStep - (Math.PI / 2);
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", centerX); line.setAttribute("y1", centerY);
                line.setAttribute("x2", x); line.setAttribute("y2", y);
                linesSvg.appendChild(line);

                const node = document.createElement('div');
                node.className = 'node';
                node.innerText = item.title;
                node.id = `node-${item.id}`;
                node.style.left = `${x}px`;
                node.style.top = `${y}px`;
                
                if(item.id === currentActiveId) node.classList.add('active');

                node.onclick = () => renderPanel(item.id);
                wheel.appendChild(node);
            });
        }

        function renderPanel(id) {
            currentActiveId = id;
            const data = damaData.find(d => d.id === id);
            
            document.querySelectorAll('.node, .center-node').forEach(n => n.classList.remove('active'));
            if(id === 0) {
                document.getElementById('node-0').classList.add('active');
            } else {
                const node = document.getElementById(`node-${id}`);
                if(node) node.classList.add('active');
            }

            document.getElementById('p-title').innerText = data.title;
            document.getElementById('p-tag').innerText = data.tag;
            
            document.getElementById('p-comp').innerHTML = 
                data.essential_components ? data.essential_components.map(x => `<li>${x}</li>`).join('') : "";

            document.getElementById('p-deliv').innerHTML = 
                data.key_deliverables ? data.key_deliverables.map(x => `<li>${x}</li>`).join('') : "";

            document.getElementById('p-pitfall').innerText = data.exam_pitfall;
            document.getElementById('p-link').href = `detail.html?id=${id}`;
        }

        initWheel();
        renderPanel(0);

        window.addEventListener('resize', () => {
            initWheel();
            const activeNode = document.getElementById(`node-${currentActiveId}`);
            if(activeNode && currentActiveId !== 0) activeNode.classList.add('active');
        });
    </script>
</body>
</html>
